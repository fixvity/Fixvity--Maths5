<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Graphing Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:#f4f6fb}
.app{display:flex;height:100vh}
.sidebar{
  width:340px;background:#fff;border-right:1px solid #ddd;
  padding:12px;overflow:auto
}
@media(max-width:900px){
  .app{flex-direction:column}
  .sidebar{width:100%;border-right:none;border-bottom:1px solid #ddd}
}
h3{margin:8px 0}
label{font-size:14px;font-weight:600}
input,select{
  width:100%;padding:8px;margin-top:6px;
  border-radius:6px;border:1px solid #ccc
}
.row{margin-bottom:10px}
.btn{
  width:100%;padding:10px;margin-top:8px;
  border:none;border-radius:6px;
  background:#2563eb;color:#fff;
  font-weight:700;cursor:pointer
}
.btn.alt{background:#eef2ff;color:#111}
.graph-area{flex:1;position:relative;background:#fff}
canvas{width:100%!important;height:100%!important}
.panel{
  position:absolute;right:10px;top:10px;width:300px;
  background:#fff;border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,.15)
}
.panel header{background:#2563eb;color:#fff;padding:8px 12px}
.panel .body{padding:8px;max-height:260px;overflow:auto;font-size:14px}
@media(max-width:900px){
  .panel{position:static;width:100%;margin-top:10px}
}
</style>
</head>

<body>
<div class="app">

<div class="sidebar">

<h3>Graph Mode</h3>
<select id="mode" onchange="draw()">
  <option value="cartesian">y = f(x)</option>
  <option value="polar">Polar (r = f(Î¸))</option>
  <option value="parametric">Parametric</option>
</select>

<div class="row">
<label>Function</label>
<input id="fx" value="sin(x)">
</div>

<div id="parametric" style="display:none">
<div class="row">
<label>x(t)</label>
<input id="xt" value="cos(t)">
</div>
<div class="row">
<label>y(t)</label>
<input id="yt" value="sin(t)">
</div>
</div>

<div class="row">
<label>Derivative</label>
<input type="checkbox" id="deriv" checked>
</div>

<div class="row">
<label>Integral (a â†’ b)</label>
<input id="a" value="0">
<input id="b" value="3.14">
</div>

<div class="row">
<input type="checkbox" id="roots" checked> Roots
</div>
<div class="row">
<input type="checkbox" id="inter" checked> Intersections
</div>

<button class="btn" onclick="save()">ðŸ’¾ Save</button>
<button class="btn alt" onclick="share()">ðŸ”— Share</button>

</div>

<div class="graph-area">
<canvas id="graph"></canvas>

<div class="panel">
<header>Key Points</header>
<div class="body" id="info"></div>
</div>
</div>
</div>

<script>
let chart;
const info=document.getElementById("info");

function F(expr,x){try{return Function("x","with(Math){return "+expr+"}")(x)}catch{return null}}
function Ft(expr,t){try{return Function("t","with(Math){return "+expr+"}")(t)}catch{return null}}

function derivative(expr,x){
  const h=1e-5;
  return (F(expr,x+h)-F(expr,x-h))/(2*h);
}

function draw(){
  const mode=document.getElementById("mode").value;
  document.getElementById("parametric").style.display=
    mode==="parametric"?"block":"none";

  const xs=[],ys=[],labels=[];
  info.innerHTML="";

  if(mode==="cartesian"){
    for(let x=-10;x<=10;x+=0.05){
      labels.push(x);
      xs.push(x);
      ys.push(F(fx.value,x));
    }
  }

  if(mode==="polar"){
    for(let t=0;t<=Math.PI*2;t+=0.02){
      const r=F(fx.value,t);
      xs.push(r*Math.cos(t));
      ys.push(r*Math.sin(t));
      labels.push("");
    }
  }

  if(mode==="parametric"){
    for(let t=0;t<=Math.PI*2;t+=0.02){
      xs.push(Ft(xt.value,t));
      ys.push(Ft(yt.value,t));
      labels.push("");
    }
  }

  const datasets=[{
    label:"Graph",
    data:xs.map((x,i)=>({x,y:ys[i]})),
    borderColor:"#2563eb",
    pointRadius:0,
    fill:false
  }];

  chart?.destroy();
  chart=new Chart(graph,{
    type:"scatter",
    data:{datasets},
    options:{responsive:true,maintainAspectRatio:false}
  });
}

function save(){
  localStorage.setItem("graph10",JSON.stringify({
    mode:mode.value,fx:fx.value,xt:xt.value,yt:yt.value
  }));
  alert("Saved");
}
function share(){
  const d=btoa(JSON.stringify({
    mode:mode.value,fx:fx.value,xt:xt.value,yt:yt.value
  }));
  navigator.clipboard.writeText(location.origin+location.pathname+"?g="+d);
  alert("Link copied");
}

(function(){
  const p=new URLSearchParams(location.search);
  const d=p.get("g")||localStorage.getItem("graph10");
  if(!d) return draw();
  try{
    const s=JSON.parse(atob(d));
    mode.value=s.mode||"cartesian";
    fx.value=s.fx||"sin(x)";
    xt.value=s.xt||"cos(t)";
    yt.value=s.yt||"sin(t)";
  }catch{}
  draw();
})();
</script>
</body>
</html>

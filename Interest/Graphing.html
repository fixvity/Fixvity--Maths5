<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Graphing Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:#f4f6fb;
  overscroll-behavior:none;
}
.app{
  display:flex;
  min-height:100svh; /* mobile safe */
}

/* ===== SIDEBAR ===== */
.sidebar{
  width:320px;
  background:#fff;
  border-right:1px solid #ddd;
  padding:14px;
  overflow-y:auto;
}
h3{margin:6px 0 10px}
label{font-size:14px;font-weight:600}
input,select{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:15px;
}
.row{margin-bottom:12px}

.btn{
  width:100%;
  padding:12px;
  border:none;
  border-radius:8px;
  font-weight:700;
  cursor:pointer;
}
.btn.primary{background:#2563eb;color:#fff}
.btn.alt{background:#eef2ff}

/* ===== GRAPH AREA ===== */
.graph-area{
  flex:1;
  position:relative;
  background:#fff;
  display:flex;
  flex-direction:column;
}
.canvas-wrap{
  flex:1;
  position:relative;
}
canvas{
  width:100%!important;
  height:100%!important;
}

/* ===== INFO PANEL ===== */
.panel{
  background:#fff;
  border-top:1px solid #e5e7eb;
  padding:10px;
  font-size:14px;
}
.panel h4{
  margin:0 0 6px;
  color:#2563eb;
}

/* ===== MOBILE ===== */
@media(max-width:900px){
  .app{flex-direction:column}
  .sidebar{
    width:100%;
    border-right:none;
    border-bottom:1px solid #ddd;
  }
}
</style>
</head>

<body>
<div class="app">

<!-- ===== CONTROLS ===== -->
<div class="sidebar">

<h3>Graph Mode</h3>
<select id="mode">
  <option value="cartesian">y = f(x)</option>
  <option value="polar">Polar r(θ)</option>
  <option value="parametric">Parametric</option>
</select>

<div class="row">
<label>Function</label>
<input id="fx" value="sin(x)">
</div>

<div id="parametricBox" style="display:none">
<div class="row">
<label>x(t)</label>
<input id="xt" value="cos(t)">
</div>
<div class="row">
<label>y(t)</label>
<input id="yt" value="sin(t)">
</div>
</div>

<div class="row">
<label>Integral a → b</label>
<input id="a" value="0">
<input id="b" value="3.14">
</div>

<button class="btn primary" onclick="draw()">Plot</button>
<button class="btn alt" onclick="save()">Save</button>
<button class="btn alt" onclick="share()">Share</button>

</div>

<!-- ===== GRAPH ===== -->
<div class="graph-area">
<div class="canvas-wrap">
<canvas id="graph"></canvas>
</div>

<div class="panel">
<h4>Graph Info</h4>
<div id="info">Ready</div>
</div>
</div>

</div>

<script>
let chart;
const $=id=>document.getElementById(id);
const info=$("info");

function safeEval(expr,v,letter){
  try{
    return Function(letter,`with(Math){return ${expr}}`)(v);
  }catch{
    return null;
  }
}

function draw(){
  const mode=$("mode").value;
  $("parametricBox").style.display = mode==="parametric"?"block":"none";

  const points=[];
  info.textContent="Plotting…";

  if(mode==="cartesian"){
    for(let x=-10;x<=10;x+=0.05){
      const y=safeEval($("fx").value,x,"x");
      if(y!==null && isFinite(y)) points.push({x,y});
    }
  }

  if(mode==="polar"){
    for(let t=0;t<=Math.PI*2;t+=0.02){
      const r=safeEval($("fx").value,t,"x");
      if(r!==null){
        points.push({
          x:r*Math.cos(t),
          y:r*Math.sin(t)
        });
      }
    }
  }

  if(mode==="parametric"){
    for(let t=0;t<=Math.PI*2;t+=0.02){
      const x=safeEval($("xt").value,t,"t");
      const y=safeEval($("yt").value,t,"t");
      if(x!==null && y!==null) points.push({x,y});
    }
  }

  chart?.destroy();
  chart=new Chart(graph,{
    type:"scatter",
    data:{
      datasets:[{
        label:"Graph",
        data:points,
        borderColor:"#2563eb",
        borderWidth:2,
        showLine:true,
        pointRadius:0
      }]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      animation:false,
      scales:{
        x:{type:"linear"},
        y:{type:"linear"}
      }
    }
  });

  info.textContent=`Points plotted: ${points.length}`;
}

function save(){
  localStorage.setItem("graphState",JSON.stringify({
    mode:mode.value,
    fx:fx.value,
    xt:xt.value,
    yt:yt.value,
    a:a.value,
    b:b.value
  }));
  alert("Saved");
}

function share(){
  const data=btoa(JSON.stringify({
    mode:mode.value,
    fx:fx.value,
    xt:xt.value,
    yt:yt.value
  }));
  navigator.clipboard.writeText(
    location.origin+location.pathname+"?g="+data
  );
  alert("Link copied");
}

(function init(){
  const p=new URLSearchParams(location.search);
  const s=p.get("g")||localStorage.getItem("graphState");
  if(!s){ draw(); return; }
  try{
    const d=JSON.parse(atob(s));
    Object.assign(window,d);
    fx.value=d.fx||"sin(x)";
    xt.value=d.xt||"cos(t)";
    yt.value=d.yt||"sin(t)";
    mode.value=d.mode||"cartesian";
  }catch{}
  draw();
})();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Graphing Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --primary:#2563eb;
  --bg:#f4f7fb;
  --card:#ffffff;
  --text:#111827;
  --muted:#6b7280;
  --radius:14px;
  --shadow:0 10px 30px rgba(0,0,0,.08);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Inter,Arial;
  background:var(--bg);
  color:var(--text);
}
.container{
  max-width:1200px;
  margin:auto;
  padding:14px;
}

/* HEADER */
.header{
  background:var(--card);
  padding:18px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  text-align:center;
}
.header h1{margin:0;color:var(--primary)}
.header p{margin:6px 0 0;color:var(--muted)}

/* LAYOUT */
.grid{
  display:grid;
  grid-template-columns:320px 1fr;
  gap:16px;
  margin-top:16px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}

/* CARD */
.card{
  background:var(--card);
  padding:16px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}

/* INPUTS */
label{font-size:14px;font-weight:600}
input{
  width:100%;
  padding:10px;
  margin-top:6px;
  margin-bottom:12px;
  border-radius:10px;
  border:1px solid #e5e7eb;
  font-size:15px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}
.primary{background:var(--primary);color:#fff}
.secondary{background:#eef2f7}

/* GRAPH */
.graph-wrap{
  background:var(--card);
  padding:14px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}
canvas{
  height:360px!important;
  touch-action:manipulation;
}

/* ACTIONS */
.action-row{
  display:flex;
  gap:10px;
  margin-top:12px;
}
.action-row button{flex:1}
@media(max-width:600px){
  .action-row{flex-direction:column}
}

/* TABLE */
.table-wrap{
  margin-top:16px;
  max-height:260px;
  overflow:auto;
  border-radius:12px;
  border:1px solid #e5e7eb;
}
table{
  width:100%;
  border-collapse:collapse;
}
th{
  position:sticky;
  top:0;
  background:var(--primary);
  color:#fff;
  padding:10px;
}
td{
  padding:10px;
  border-bottom:1px solid #e5e7eb;
  text-align:right;
}
td:first-child{text-align:left}
</style>
</head>

<body>
<div class="container">

<!-- HEADER -->
<div class="header">
  <h1>Advanced Graphing Calculator</h1>
  <p>Tap the graph to place a tangent line instantly</p>
</div>

<div class="grid">

<!-- LEFT PANEL -->
<div class="card">
  <label>Function f(x)</label>
  <input id="fx" value="sin(x)">

  <label>Integral from a to b</label>
  <input id="a" value="0">
  <input id="b" value="3.14">

  <button class="primary" onclick="plot()">Plot Graph</button>
  <button class="secondary" onclick="resetAll()">Reset</button>
</div>

<!-- RIGHT PANEL -->
<div>

<div class="graph-wrap">
  <canvas id="graphCanvas"></canvas>

  <div class="action-row">
    <button class="primary" onclick="downloadGraph()">ðŸ“¥ Download</button>
    <button class="primary" onclick="shareGraph()">ðŸ”— Share</button>
  </div>
</div>

<div class="card" style="margin-top:16px">
  <h3>Table of Values</h3>
  <div class="table-wrap">
    <table>
      <thead>
        <tr><th>x</th><th>f(x)</th></tr>
      </thead>
      <tbody id="table"></tbody>
    </table>
  </div>
</div>

</div>
</div>
</div>

<script>
const fxInput=document.getElementById("fx");
const aInput=document.getElementById("a");
const bInput=document.getElementById("b");
const graphCanvas=document.getElementById("graphCanvas");
const table=document.getElementById("table");

let chart;
let tangentX=null;

/* SAFE FUNCTION */
function f(x){
  try{
    return Function("x","with(Math){return "+fxInput.value+"}")(x);
  }catch{return NaN;}
}

/* NUMERICAL DERIVATIVE */
function derivative(x){
  const h=1e-4;
  return (f(x+h)-f(x-h))/(2*h);
}

/* MAIN PLOT */
function plot(){
  const xs=[],ys=[],tan=[];
  const step=0.05;

  for(let x=-10;x<=10;x+=step){
    xs.push(x);
    ys.push(f(x));

    if(tangentX!==null){
      const m=derivative(tangentX);
      const y0=f(tangentX);
      tan.push(m*(x-tangentX)+y0);
    }
  }

  chart?.destroy();
  chart=new Chart(graphCanvas,{
    type:"line",
    data:{
      labels:xs,
      datasets:[
        {
          label:"f(x)",
          data:ys,
          borderColor:"#2563eb",
          borderWidth:2,
          pointRadius:0
        },
        {
          label:"Tangent",
          data:tangentX!==null?tan:[],
          borderColor:"#dc2626",
          borderDash:[6,6],
          borderWidth:2,
          pointRadius:0
        }
      ]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      interaction:{mode:"nearest",intersect:false},
      scales:{x:{type:"linear"}}
    }
  });

  renderTable(xs,ys);
}

/* TAP / CLICK TO PLACE TANGENT */
graphCanvas.addEventListener("click",(evt)=>{
  const p=chart.getElementsAtEventForMode(
    evt,"nearest",{intersect:false},true
  );
  if(!p.length) return;
  tangentX=chart.data.labels[p[0].index];
  plot();
});

/* TABLE */
function renderTable(xs,ys){
  table.innerHTML="";
  for(let i=0;i<xs.length;i+=20){
    table.innerHTML+=
      `<tr><td>${xs[i].toFixed(2)}</td><td>${ys[i].toFixed(4)}</td></tr>`;
  }
}

/* DOWNLOAD */
function downloadGraph(){
  const a=document.createElement("a");
  a.download="graph.png";
  a.href=graphCanvas.toDataURL("image/png");
  a.click();
}

/* SHARE */
function shareGraph(){
  const data=btoa(JSON.stringify({
    fx:fxInput.value,
    a:aInput.value,
    b:bInput.value
  }));
  navigator.clipboard.writeText(
    location.origin+location.pathname+"?g="+data
  );
  alert("Share link copied");
}

/* RESTORE */
(function(){
  const p=new URLSearchParams(location.search);
  if(!p.has("g")) return plot();
  try{
    const s=JSON.parse(atob(p.get("g")));
    fxInput.value=s.fx||"sin(x)";
    aInput.value=s.a||0;
    bInput.value=s.b||3.14;
  }catch{}
  plot();
})();

function resetAll(){
  fxInput.value="sin(x)";
  tangentX=null;
  plot();
}

plot();
</script>
</body>
</html>

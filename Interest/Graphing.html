<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Graphing Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:#f4f6fb}
.app{display:flex;height:100vh}

/* SIDEBAR */
.sidebar{
  width:340px;background:#fff;border-right:1px solid #ddd;
  padding:14px;overflow:auto
}
@media(max-width:900px){
  .app{flex-direction:column}
  .sidebar{width:100%;border-right:none;border-bottom:1px solid #ddd}
}

h2{margin:0 0 10px;color:#2563eb}
label{font-size:14px;font-weight:600}
input{
  width:100%;padding:10px;margin:6px 0 12px;
  border-radius:8px;border:1px solid #ccc;font-size:15px
}
button{
  width:100%;padding:12px;border:none;border-radius:10px;
  font-weight:700;cursor:pointer
}
.primary{background:#2563eb;color:#fff}
.secondary{background:#eef2ff;color:#111;margin-top:8px}

/* GRAPH */
.graph-area{flex:1;position:relative;background:#fff}
canvas{width:100%!important;height:100%!important}

.controls{
  position:absolute;right:12px;bottom:12px;
  display:flex;gap:10px
}
.ctrl{
  width:44px;height:44px;border-radius:50%;
  background:#2563eb;color:#fff;border:none;
  font-size:20px;cursor:pointer
}
/* MOBILE GRAPH HEIGHT FIX */
@media (max-width: 900px) {
  .graph-area {
    height: 65vh;      /* taller chart */
    min-height: 420px; /* ensures clarity */
  }

  canvas {
    height: 100% !important;
  }
}
/* TABLE */
.table-wrap{
  margin-top:12px;max-height:220px;overflow:auto;
  border:1px solid #e5e7eb;border-radius:10px
}
table{width:100%;border-collapse:collapse}
th{
  background:#2563eb;color:#fff;padding:8px;
  position:sticky;top:0
}
td{padding:8px;border-bottom:1px solid #e5e7eb;text-align:right}
td:first-child{text-align:left}

/* POINT INSPECTOR */
#inspector{
  position:absolute;
  background:#111827;
  color:#fff;
  padding:6px 10px;
  border-radius:8px;
  font-size:13px;
  pointer-events:none;
  display:none;
  transform:translate(-50%,-120%);
  white-space:nowrap;
}
</style>
</head>

<body>
<div class="app">

<!-- SIDEBAR -->
<div class="sidebar">
<h2>Graphing Calculator</h2>

<label>f(x)</label>
<input id="f1" value="sin(x)">

<label>g(x)</label>
<input id="f2" value="x*x">

<label>h(x)</label>
<input id="f3" value="">

<label>Tangent at x</label>
<input id="tx" value="1">

<button class="primary" onclick="plot()">Plot</button>
<button class="secondary" onclick="resetZoom()">Reset Zoom</button>

<div class="table-wrap">
<table>
<thead><tr><th>x</th><th>f(x)</th></tr></thead>
<tbody id="table"></tbody>
</table>
</div>
</div>

<!-- GRAPH -->
<div class="graph-area">
<canvas id="graph"></canvas>
<div id="inspector"></div>

<div class="controls">
<button class="ctrl" onclick="chart && chart.zoom(1.2)">+</button>
<button class="ctrl" onclick="chart && chart.zoom(0.8)">âˆ’</button>
</div>
</div>

</div>

<script>
let chart;
const table=document.getElementById("table");
const graph=document.getElementById("graph");
const inspector=document.getElementById("inspector");

const f1=document.getElementById("f1");
const f2=document.getElementById("f2");
const f3=document.getElementById("f3");
const tx=document.getElementById("tx");

function fx(expr,x){
  try{return Function("x","with(Math){return "+expr+"}")(x)}
  catch{return null}
}

function derivative(expr,x){
  const h=1e-4;
  return (fx(expr,x+h)-fx(expr,x-h))/(2*h);
}

function plot(){
  const xs=[], f1y=[], f2y=[], f3y=[];
  table.innerHTML="";

  for(let x=-10;x<=10;x+=0.05){
    xs.push(x);
    f1y.push(fx(f1.value,x));
    f2y.push(f2.value?fx(f2.value,x):null);
    f3y.push(f3.value?fx(f3.value,x):null);
  }

  const x0=+tx.value;
  const y0=fx(f1.value,x0);
  const m=derivative(f1.value,x0);
  const tan=xs.map(x=>m*(x-x0)+y0);

  for(let i=0;i<xs.length;i+=40){
    table.innerHTML+=`<tr><td>${xs[i].toFixed(2)}</td><td>${f1y[i]?.toFixed(4)}</td></tr>`;
  }

  chart?.destroy();
  chart=new Chart(graph,{
    type:"line",
    data:{
      labels:xs,
      datasets:[
        {label:"f(x)",data:f1y,borderColor:"#2563eb",pointRadius:0},
        {label:"g(x)",data:f2y,borderColor:"#16a34a",pointRadius:0},
        {label:"h(x)",data:f3y,borderColor:"#f59e0b",pointRadius:0},
        {label:"Tangent",data:tan,borderColor:"#dc2626",borderDash:[6,6],pointRadius:0},
        {
          label:"Point",
          data:[],
          pointRadius:6,
          pointBackgroundColor:"#000",
          showLine:false
        }
      ]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      interaction:{mode:"nearest",intersect:false},
      plugins:{
        zoom:{
          pan:{enabled:true,mode:"xy"},
          zoom:{wheel:{enabled:true},pinch:{enabled:true},mode:"xy"}
        }
      },
      scales:{x:{type:"linear"}},
      onClick:(evt)=>{
        const points=chart.getElementsAtEventForMode(
          evt,"nearest",{intersect:false},true
        );
        if(!points.length) return;

        const p=points[0];
        const x=chart.data.labels[p.index];
        const y=chart.data.datasets[p.datasetIndex].data[p.index];

        chart.data.datasets.at(-1).data=[{x,y}];
        chart.update("none");

        const rect=graph.getBoundingClientRect();
        inspector.style.left=evt.clientX-rect.left+"px";
        inspector.style.top=evt.clientY-rect.top+"px";
        inspector.textContent=`x = ${x.toFixed(3)}, y = ${y.toFixed(4)}`;
        inspector.style.display="block";
      }
    }
  });
}

function resetZoom(){
  chart && chart.resetZoom();
  inspector.style.display="none";
}

graph.addEventListener("dblclick",resetZoom);
plot();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Graphing Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:#f4f6fb}
.app{display:flex;height:100vh}

/* SIDEBAR */
.sidebar{
  width:340px;background:#fff;border-right:1px solid #ddd;
  padding:14px;overflow:auto
}
@media(max-width:900px){
  .app{flex-direction:column}
  .sidebar{width:100%;border-right:none;border-bottom:1px solid #ddd}
}

h2{margin:0 0 10px;color:#2563eb}

/* MODE TOGGLE */
.mode-toggle{
  display:flex;gap:8px;margin-bottom:12px
}
.mode-toggle button{
  flex:1;padding:10px;border:none;border-radius:8px;
  font-weight:700;cursor:pointer;background:#eef2ff
}
.mode-toggle .active{
  background:#2563eb;color:#fff
}

label{font-size:14px;font-weight:600}
input{
  width:100%;padding:10px;margin:6px 0 12px;
  border-radius:8px;border:1px solid #ccc;font-size:15px
}
button.primary{
  width:100%;padding:12px;border:none;border-radius:10px;
  font-weight:700;cursor:pointer;background:#2563eb;color:#fff
}
button.secondary{
  width:100%;padding:12px;border:none;border-radius:10px;
  font-weight:700;cursor:pointer;background:#eef2ff;margin-top:8px
}

/* GRAPH */
.graph-area{flex:1;position:relative;background:#fff}
canvas{width:100%!important;height:100%!important}

@media(max-width:900px){
  .graph-area{height:65vh;min-height:420px}
}

.controls{
  position:absolute;right:12px;bottom:12px;
  display:flex;gap:10px
}
.ctrl{
  width:44px;height:44px;border-radius:50%;
  background:#2563eb;color:#fff;border:none;
  font-size:20px;cursor:pointer
}

/* TABLE */
.table-wrap{
  margin-top:12px;max-height:220px;overflow:auto;
  border:1px solid #e5e7eb;border-radius:10px
}
table{width:100%;border-collapse:collapse}
th{
  background:#2563eb;color:#fff;padding:8px;
  position:sticky;top:0
}
td{padding:8px;border-bottom:1px solid #e5e7eb;text-align:right}
td:first-child{text-align:left}

/* POINT INSPECTOR */
#inspector{
  position:absolute;background:#111827;color:#fff;
  padding:6px 10px;border-radius:8px;
  font-size:13px;display:none;
  transform:translate(-50%,-120%);
  white-space:nowrap;pointer-events:none
}
</style>
</head>

<body>
<div class="app">

<!-- SIDEBAR -->
<div class="sidebar">
<h2>Graphing Calculator</h2>

<div class="mode-toggle">
  <button id="basicBtn" class="active">Basic</button>
  <button id="advancedBtn">Advanced</button>
</div>

<!-- BASIC MODE -->
<div id="basicMode">
  <label>Equation</label>
  <input id="basicEq" value="y = 2*x + 1">

  <label>Window</label>
  <input id="xmin" value="-10">
  <input id="xmax" value="10">
  <input id="ymin" value="-10">
  <input id="ymax" value="10">

  <button class="primary" onclick="plotBasic()">Graph</button>
</div>

<!-- ADVANCED MODE -->
<div id="advancedMode" style="display:none">
  <label>f(x)</label>
  <input id="f1" value="sin(x)">

  <label>g(x)</label>
  <input id="f2" value="x*x">

  <label>h(x)</label>
  <input id="f3" value="">

  <label>Tangent at x</label>
  <input id="tx" value="1">

  <button class="primary" onclick="plot()">Plot</button>
  <button class="secondary" onclick="resetZoom()">Reset Zoom</button>

  <div class="table-wrap">
    <table>
      <thead><tr><th>x</th><th>f(x)</th></tr></thead>
      <tbody id="table"></tbody>
    </table>
  </div>
</div>
</div>

<!-- GRAPH -->
<div class="graph-area">
<canvas id="graph"></canvas>
<div id="inspector"></div>

<div class="controls">
  <button class="ctrl" onclick="chart.zoom(1.2)">+</button>
  <button class="ctrl" onclick="chart.zoom(0.8)">âˆ’</button>
</div>
</div>

</div>

<script>
let chart;
const graph=document.getElementById("graph");
const inspector=document.getElementById("inspector");
const table=document.getElementById("table");

const f1=document.getElementById("f1");
const f2=document.getElementById("f2");
const f3=document.getElementById("f3");
const tx=document.getElementById("tx");

/* MODE SWITCH */
basicBtn.onclick=()=>{
  basicMode.style.display="block";
  advancedMode.style.display="none";
  basicBtn.classList.add("active");
  advancedBtn.classList.remove("active");
};
advancedBtn.onclick=()=>{
  basicMode.style.display="none";
  advancedMode.style.display="block";
  advancedBtn.classList.add("active");
  basicBtn.classList.remove("active");
};

function fx(expr,x){
  try{return Function("x","with(Math){return "+expr+"}")(x)}
  catch{return null}
}
function derivative(expr,x){
  const h=1e-4;
  return (fx(expr,x+h)-fx(expr,x-h))/(2*h);
}

function plot(){
  const xs=[],f1y=[],f2y=[],f3y=[];
  table.innerHTML="";

  for(let x=-10;x<=10;x+=0.05){
    xs.push(x);
    f1y.push(fx(f1.value,x));
    f2y.push(f2.value?fx(f2.value,x):null);
    f3y.push(f3.value?fx(f3.value,x):null);
  }

  const x0=+tx.value;
  const y0=fx(f1.value,x0);
  const m=derivative(f1.value,x0);
  const tan=xs.map(x=>m*(x-x0)+y0);

  for(let i=0;i<xs.length;i+=40){
    table.innerHTML+=`<tr><td>${xs[i].toFixed(2)}</td><td>${f1y[i]?.toFixed(4)}</td></tr>`;
  }

  renderChart(xs,f1y,f2y,f3y,tan);
}

function plotBasic(){
  f1.value=document.getElementById("basicEq").value.replace("y=","");
  plot();
  chart.options.scales.x.min=+xmin.value;
  chart.options.scales.x.max=+xmax.value;
  chart.options.scales.y.min=+ymin.value;
  chart.options.scales.y.max=+ymax.value;
  chart.update();
}

function renderChart(xs,f1y,f2y,f3y,tan){
  chart?.destroy();
  chart=new Chart(graph,{
    type:"line",
    data:{
      labels:xs,
      datasets:[
        {label:"f(x)",data:f1y,borderColor:"#2563eb",pointRadius:0},
        {label:"g(x)",data:f2y,borderColor:"#16a34a",pointRadius:0},
        {label:"h(x)",data:f3y,borderColor:"#f59e0b",pointRadius:0},
        {label:"Tangent",data:tan,borderColor:"#dc2626",borderDash:[6,6],pointRadius:0},
        {label:"Point",data:[],pointRadius:6,showLine:false}
      ]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      interaction:{mode:"nearest",intersect:false},
      plugins:{
        zoom:{
          pan:{enabled:true,mode:"xy"},
          zoom:{wheel:{enabled:true},pinch:{enabled:true},mode:"xy"}
        }
      },
      scales:{x:{type:"linear"}},
      onClick:(evt)=>{
        const pts=chart.getElementsAtEventForMode(evt,"nearest",{intersect:false},true);
        if(!pts.length)return;
        const p=pts[0];
        const x=chart.data.labels[p.index];
        const y=chart.data.datasets[p.datasetIndex].data[p.index];
        chart.data.datasets.at(-1).data=[{x,y}];
        chart.update("none");

        const r=graph.getBoundingClientRect();
        inspector.style.left=evt.clientX-r.left+"px";
        inspector.style.top=evt.clientY-r.top+"px";
        inspector.textContent=`x=${x.toFixed(3)}, y=${y.toFixed(4)}`;
        inspector.style.display="block";
      }
    }
  });
}

function resetZoom(){
  chart.resetZoom();
  inspector.style.display="none";
}

graph.addEventListener("dblclick",resetZoom);
plot();
</script>
</body>
</html>
